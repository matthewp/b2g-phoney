if(!navigator.apps){navigator.apps={}}if(!navigator.apps.install||navigator.apps.html5Implementation){navigator.apps=(function(){var j=(function(){var x=Math.floor(Math.random()*1000001);var C={};function A(E,G,F){var H=false;if(E==="*"){for(var D in C){if(!C.hasOwnProperty(D)){continue}if(D==="*"){continue}if(typeof C[D][G]==="object"){H=true}}}else{if((C["*"]&&C["*"][G])||(C[E]&&C[E][G])){H=true}}if(H){throw"A channel already exists which overlaps with origin '"+E+"' and has scope '"+G+"'"}if(typeof C[E]!="object"){C[E]={}}C[E][G]=F}function y(D,E){delete C[D][E]}function B(D){if(Array.isArray){return Array.isArray(D)}else{return(D.constructor.toString().indexOf("Array")!=-1)}}var w={};var z=function(I){var D=JSON.parse(I.data);if(typeof D!=="object"){return}var J=I.origin;var H=null;var G=null;var E=null;if(typeof D.method==="string"){var F=D.method.split("::");if(F.length==2){H=F[0];E=F[1]}else{E=D.method}}if(typeof D.id!=="undefined"){G=D.id}if(typeof E==="string"){if(C[J]&&C[J][H]){C[J][H](J,E,D)}else{if(C["*"]&&C["*"][H]){C["*"][H](J,E,D)}}}else{if(typeof G!="undefined"){if(w[G]){w[G](J,E,D)}}}};if(window.addEventListener){window.addEventListener("message",z,false)}else{if(window.attachEvent){window.attachEvent("onmessage",z)}}return{build:function(M){var E=function(T){if(M.debugOutput&&window.console&&window.console.log){try{if(typeof T!=="string"){T=JSON.stringify(T)}}catch(U){}console.log("["+G+"] "+T)}};if(!window.postMessage){throw ("jschannel cannot run this browser, no postMessage")}if(!window.JSON||!window.JSON.stringify||!window.JSON.parse){throw ("jschannel cannot run this browser, no JSON parsing/serialization")}if(typeof M!="object"){throw ("Channel build invoked without a proper object argument")}if(!M.window||!M.window.postMessage){throw ("Channel.build() called without a valid window argument")}if(window===M.window){throw ("target window is same as present window -- not allowed")}var F=false;if(typeof M.origin==="string"){var H;if(M.origin==="*"){F=true}else{if(null!==(H=M.origin.match(/^https?:\/\/(?:[-a-zA-Z0-9\.])+(?::\d+)?/))){M.origin=H[0];F=true}}}if(!F){throw ("Channel.build() called with an invalid origin")}if(typeof M.scope!=="undefined"){if(typeof M.scope!=="string"){throw"scope, when specified, must be a string"}if(M.scope.split("::").length>1){throw"scope may not contain double colons: '::'"}}var G=(function(){var V="";var U="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";for(var T=0;T<5;T++){V+=U.charAt(Math.floor(Math.random()*U.length))}return V})();var Q={};var D={};var N={};var P=false;var S=[];var J=function(X,T,W){var V=false;var U=false;return{origin:T,invoke:function(ab,Y){if(!N[X]){throw"attempting to invoke a callback of a non-existant transaction: "+X}var aa=false;for(var Z=0;Z<W.length;Z++){if(ab===W[Z]){aa=true;break}}if(!aa){throw"request supports no such callback '"+ab+"'"}O({id:X,callback:ab,params:Y})},error:function(Y,Z){U=true;if(!N[X]){throw"error called for non-existant message: "+X}delete N[X];O({id:X,error:Y,message:Z})},complete:function(Y){U=true;if(!N[X]){throw"complete called for non-existant message: "+X}delete N[X];O({id:X,result:Y})},delayReturn:function(Y){if(typeof Y==="boolean"){V=(Y===true)}return V},completed:function(){return U}}};var R=function(ae,T,V){if(typeof M.gotMessageObserver==="function"){try{M.gotMessageObserver(ae,V)}catch(aa){E("gotMessageObserver() raised an exception: "+aa.toString())}}if(V.id&&T){if(Q[T]){var ah=J(V.id,ae,V.callbacks?V.callbacks:[]);N[V.id]={};try{if(V.callbacks&&B(V.callbacks)&&V.callbacks.length>0){for(var Z=0;Z<V.callbacks.length;Z++){var ag=V.callbacks[Z];var Y=V.params;var U=ag.split("/");for(var X=0;X<U.length-1;X++){var ad=U[X];if(typeof Y[ad]!=="object"){Y[ad]={}}Y=Y[ad]}Y[U[U.length-1]]=(function(){var ai=ag;return function(aj){return ah.invoke(ai,aj)}})()}}var W=Q[T](ah,V.params);if(!ah.delayReturn()&&!ah.completed()){ah.complete(W)}}catch(aa){var ac="runtime_error";var af=null;if(typeof aa==="string"){af=aa}else{if(typeof aa==="object"){if(aa&&B(aa)&&aa.length==2){ac=aa[0];af=aa[1]}else{if(typeof aa.error==="string"){ac=aa.error;if(!aa.message){af=""}else{if(typeof aa.message==="string"){af=aa.message}else{aa=aa.message}}}}}}if(af===null){try{af=JSON.stringify(aa)}catch(ab){af=aa.toString()}}ah.error(ac,af)}}}else{if(V.id&&V.callback){if(!D[V.id]||!D[V.id].callbacks||!D[V.id].callbacks[V.callback]){E("ignoring invalid callback, id:"+V.id+" ("+V.callback+")")}else{D[V.id].callbacks[V.callback](V.params)}}else{if(V.id){if(!D[V.id]){E("ignoring invalid response: "+V.id)}else{if(V.error){(1,D[V.id].error)(V.error,V.message)}else{if(V.result!==undefined){(1,D[V.id].success)(V.result)}else{(1,D[V.id].success)()}}delete D[V.id];delete w[V.id]}}else{if(T){if(Q[T]){Q[T](null,V.params)}}}}}};A(M.origin,((typeof M.scope==="string")?M.scope:""),R);var I=function(T){if(typeof M.scope==="string"&&M.scope.length){T=[M.scope,T].join("::")}return T};var O=function(W,T){if(!W){throw"postMessage called with null message"}var V=(P?"post  ":"queue ");E(V+" message: "+JSON.stringify(W));if(!T&&!P){S.push(W)}else{if(typeof M.postMessageObserver==="function"){try{M.postMessageObserver(M.origin,W)}catch(U){E("postMessageObserver() raised an exception: "+U.toString())}}M.window.postMessage(JSON.stringify(W),M.origin)}};var L=function(T,U){E("ready msg received");if(P){throw"received ready message while in ready state.  help!"}if(U==="ping"){G+="-R"}else{G+="-L"}K.unbind("__ready");P=true;E("ready msg accepted.");if(U==="ping"){K.notify({method:"__ready",params:"pong"})}while(S.length){O(S.pop())}if(typeof M.onReady==="function"){M.onReady(K)}};var K={unbind:function(T){if(Q[T]){if(!(delete Q[T])){throw ("can't delete method: "+T)}return true}return false},bind:function(U,T){if(!U||typeof U!=="string"){throw"'method' argument to bind must be string"}if(!T||typeof T!=="function"){throw"callback missing from bind params"}if(Q[U]){throw"method '"+U+"' is already bound!"}Q[U]=T},call:function(T){if(!T){throw"missing arguments to call function"}if(!T.method||typeof T.method!=="string"){throw"'method' argument to call must be string"}if(!T.success||typeof T.success!=="function"){throw"'success' callback missing from call"}var W={};var V=[];var U=function(ab,aa){if(typeof aa==="object"){for(var Y in aa){if(!aa.hasOwnProperty(Y)){continue}var Z=ab+(ab.length?"/":"")+Y;if(typeof aa[Y]==="function"){W[Z]=aa[Y];V.push(Z);delete aa[Y]}else{if(typeof aa[Y]==="object"){U(Z,aa[Y])}}}}};U("",T.params);var X={id:x,method:I(T.method),params:T.params};if(V.length){X.callbacks=V}D[x]={callbacks:W,error:T.error,success:T.success};w[x]=R;x++;O(X)},notify:function(T){if(!T){throw"missing arguments to notify function"}if(!T.method||typeof T.method!=="string"){throw"'method' argument to notify must be string"}O({method:I(T.method),params:T.params})},destroy:function(){y(M.origin,((typeof M.scope==="string")?M.scope:""));if(window.removeEventListener){window.removeEventListener("message",R,false)}else{if(window.detachEvent){window.detachEvent("onmessage",R)}}P=false;Q={};N={};D={};M.origin=null;S=[];E("channel destroyed");G=""}};K.bind("__ready",L);setTimeout(function(){O({method:I("__ready"),params:"ping"},true)},0);return K}}})();var e=window;var g="https://myapps.mozillalabs.com";var c="/jsapi/include.html";var i=null;var t=null;var a="myappsOrgInstallOverlay";var q="myappsTrustedIFrame";function d(){try{r()}catch(x){}var w=document.createElement("div");w.id=a;w.style.background="#000";w.style.opacity=".66";w.style.filter="alpha(opacity=66)";w.style.position="fixed";w.style.top="0";w.style.left="0";w.style.height="100%";w.style.width="100%";w.style.zIndex="998";document.body.appendChild(w);document.getElementById(q).style.display="inline"}function r(){document.getElementById(q).style.display="none";document.body.removeChild(document.getElementById(a))}function m(){if(i){return}var w=e.document;i=document.createElement("iframe");i.id=q;i.style.position="fixed";i.style.left="50%";i.style.top="40%";i.style.width="410px";i.style.marginLeft="-205px";i.style.height="332px";i.style.marginTop="-166px";i.style.zIndex="999";i.style.opacity="1";i.style.border="2px solid #aaaaaa";i.style.MozBorderRadius="8px";i.style.WebkitBorderRadius="8px";i.style.borderRadius="8px 8px 8px 8px";i.style.display="none";w.body.appendChild(i);i.src=g+c;t=j.build({window:i.contentWindow,origin:"*",scope:"openwebapps"});t.bind("showme",function(y,x){d()});t.bind("hideme",function(y,x){r()})}function o(z,y,w){var x={code:z,message:y};if(typeof w==="function"){w.call(undefined,x)}else{throw x}}function p(x){m();if(!x){x={}}else{if(typeof(x)!=="object"){throw"parameter to install() must be an object"}for(var w in x){if(!x.hasOwnProperty(w)){continue}if(w!=="install_data"&&w!=="url"&&w!=="onsuccess"&&w!=="onerror"){throw"unsupported argument: "+w}}}if(!x.url||typeof(x.url)!=="string"){throw"install missing required url argument"}t.call({method:"install",params:{url:x.url,install_data:x.install_data||null},error:function(y,z){o(y,z,x.onerror)},success:function(){if(x.onsuccess){var y=x.onsuccess;y()}}})}function u(x,w){m();t.call({method:"amInstalled",error:function(y,z){o(y,z,w)},success:function(y){if(x!==undefined){x(y)}}})}function h(x,w){m();t.call({method:"getInstalledBy",error:function(y,z){o(y,z,w)},success:function(y){if(x!==undefined){x(y)}}})}var b=[];function s(C,x,w){var B=window.location;if((B.protocol+"//"+B.host)!==g){setTimeout(function(){o("permissionDenied","to access open web apps management apis, you must be on the same domain as the application repository",w)},0);return}for(var y in b){if(y===C){var A=y;if(b[y].manifest.launch_path!==undefined){A+=b[y].manifest.launch_path}var z=("openwebapp_"+C).replace(/[.:]/g,"_").replace(/[^a-zA-Z0-9_]/g,"");window.open(A,z);if(x){setTimeout(function(){x(true)},0)}return}}setTimeout(function(){o("noSuchApp","couldn't find application with id: "+C,w)},0)}function n(x,w){m();t.call({method:"list",error:function(y,z){o(y,z,w)},success:function(y){b=y;if(x!==undefined){x(y)}}})}function k(y,x,w){m();t.call({method:"uninstall",params:y,error:function(z,A){o(z,A,w)},success:function(z){if(x!==undefined){x(z)}}})}function l(x,w){m();t.call({method:"loadState",params:null,error:function(y,z){o(y,z,w)},success:function(y){if(x!==undefined){x(y)}}})}function f(y,x,w){m();t.call({method:"saveState",params:{state:y},error:function(z,A){o(z,A,w)},success:function(z){if(x!==undefined){x(z)}}})}function v(x,w){m();t.call({method:"loginStatus",params:{},error:function(y,z){o(y,z,w)},success:function(y){if(x!==undefined){x(y[0],y[1])}}})}return{install:p,amInstalled:u,getInstalledBy:h,mgmt:{launch:s,loadState:l,loginStatus:v,list:n,uninstall:k,saveState:f},html5Implementation:true,setRepoOrigin:function(w){g=w}}})()};